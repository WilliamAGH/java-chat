/* CSS Variables for Design System */
:root {
    /* SHADCN + COFFEE - Clean & Modern */
    /* ShadCN Base Colors */
    --shadcn-background: #ffffff;
    --shadcn-foreground: #0f172a;
    --shadcn-card: #ffffff;
    --shadcn-card-foreground: #0f172a;
    --shadcn-popover: #ffffff;
    --shadcn-popover-foreground: #0f172a;
    --shadcn-primary: #18181b;
    --shadcn-primary-foreground: #fafafa;
    --shadcn-secondary: #f4f4f5;
    --shadcn-secondary-foreground: #18181b;
    --shadcn-muted: #f4f4f5;
    --shadcn-muted-foreground: #71717a;
    --shadcn-accent: #f4f4f5;
    --shadcn-accent-foreground: #18181b;
    --shadcn-destructive: #ef4444;
    --shadcn-destructive-foreground: #fafafa;
    --shadcn-border: #e4e4e7;
    --shadcn-input: #e4e4e7;
    --shadcn-ring: #18181b;
    
    /* Coffee Accents */
    --coffee-subtle: #a16207;
    --coffee-warm: #d97706;
    --coffee-cream: #fbbf24;
    --coffee-dark: #451a03;
    --coffee-light: #fef3c7;
    
    /* Dark Mode Overrides */
    --dark-bg: #0a0a0b;
    --dark-surface-1: #101012;
    --dark-surface-2: #18181b;
    --dark-surface-3: #27272a;
    --dark-border: #3f3f46;
    --dark-border-hover: #4a4a52;
    --dark-text-primary: #fafafa;
    --dark-text-secondary: #a1a1aa;
    --dark-text-tertiary: #71717a;
    
    /* Theme Variables */
    --accent-primary: var(--coffee-warm);
    --accent-secondary: var(--coffee-cream);
    --accent-tertiary: var(--coffee-subtle);
    --dark-bg: var(--dark-bg);
    --dark-surface-1: var(--dark-surface-1);
    --dark-surface-2: var(--dark-surface-2);
    --dark-surface-3: var(--dark-surface-3);
    --dark-border: var(--dark-border);
    --dark-text-primary: var(--dark-text-primary);
    --dark-text-secondary: var(--dark-text-secondary);
    --dark-text-tertiary: var(--dark-text-tertiary);
    
    /* ShadCN Typography */
    --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    --font-mono: 'JetBrains Mono', 'Fira Code', ui-monospace, SFMono-Regular, monospace;
    
    /* Subtle Effects */
    --glow-subtle: 0 1px 3px rgba(0,0,0,0.1);
    --glow-soft: 0 2px 8px rgba(0,0,0,0.15);
    --shadow-subtle: 0 1px 3px rgba(0,0,0,0.1);
    --shadow-soft: 0 4px 12px rgba(0,0,0,0.15);
    
    /* Refined Gradients */
    --gradient-subtle: linear-gradient(135deg, var(--coffee-warm) 0%, var(--coffee-cream) 100%);
    --gradient-soft: linear-gradient(45deg, var(--coffee-subtle) 0%, var(--coffee-warm) 100%);
    
    --radius-sm: 6px;
    --radius-md: 8px;
    --radius-lg: 12px;
    --space-2: 0.5rem;
    --space-3: 0.75rem;
    --space-4: 1rem;
    --transition-fast: 150ms ease;
    --transition-smooth: 250ms cubic-bezier(0.4, 0, 0.2, 1);
}

:root {
    /* Safe fallbacks when premium solar variables are not defined (e.g., in chat.html iframe) */
    --accent-warning: var(--solar-gold, #ffa947);
    --accent-error: var(--solar-coral, #ff6e40);
    --accent-info: var(--solar-ice, #7dd3fc);
    
    /* Dark theme colors - prefer solar palette if available, otherwise fallback to base dark */
    --dark-bg: var(--solar-black, #0a0a0b);
    --dark-surface-1: var(--solar-charcoal, #101012);
    --dark-surface-2: var(--solar-ash, #18181b);
    --dark-surface-3: var(--solar-mist, #27272a);
    --dark-border: var(--solar-mist, #3f3f46);
    --dark-text-primary: #ffffff;
    --dark-text-secondary: #e6e6e6;
    --dark-text-tertiary: #cccccc;
    
    /* Solar Glow Effects */
    --glow-primary: 0 0 30px rgba(255, 107, 53, 0.6);
    --glow-secondary: 0 0 30px rgba(204, 255, 0, 0.5);
    --glow-tertiary: 0 0 30px rgba(255, 71, 87, 0.5);
    --glow-quaternary: 0 0 30px rgba(0, 210, 211, 0.5);
    --glow-warning: 0 0 20px rgba(255, 179, 71, 0.4);
    
    /* Typography Scale */
    --font-display: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    --font-mono: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    --text-xs: 0.75rem;
    --text-sm: 0.875rem;
    --text-base: 1rem;
    --text-lg: 1.125rem;
    --text-xl: 1.25rem;
    --text-2xl: 1.5rem;
    --text-3xl: 1.875rem;
    
    /* Spacing (8px grid) */
    --space-1: 0.25rem;
    --space-2: 0.5rem;
    --space-3: 0.75rem;
    --space-4: 1rem;
    --space-5: 1.25rem;
    --space-6: 1.5rem;
    --space-8: 2rem;
    --space-10: 2.5rem;
    --space-12: 3rem;
    
    /* Shadows */
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
    --shadow-lg: 0 10px 15px rgba(0,0,0,0.1);
    --shadow-xl: 0 20px 25px rgba(0,0,0,0.1);
    --shadow-2xl: 0 25px 50px rgba(0,0,0,0.25);
    --shadow-glow: 0 0 20px rgba(102, 126, 234, 0.4);
    
    /* Borders */
    --radius-sm: 4px;
    --radius-md: 6px;
    --radius-lg: 8px;
    --radius-xl: 12px;
    --radius-2xl: 16px;
    --radius-full: 9999px;
    
    /* Animations */
    --transition-fast: 150ms ease;
    --transition-base: 250ms ease;
    --transition-slow: 350ms ease;
    --animation-pulse: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    --animation-shimmer: shimmer 2s ease-in-out infinite;
}

/* Base styles - ShadCN Inspired */
body {
    font-family: var(--font-sans);
    margin: 0;
    background: var(--dark-bg);
    color: var(--dark-text-primary);
    line-height: 1.5;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ShadCN Animations */
@keyframes fadeIn { 
    from { opacity: 0; transform: translateY(10px); } 
    to { opacity: 1; transform: translateY(0); } 
}

@keyframes subtle-pulse {
    0%, 100% { opacity: 0.9; }
    50% { opacity: 1; }
}

/* Animations */
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
@keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideDown { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 500px; } }
@keyframes typing { from { opacity: 0; } to { opacity: 1; } }

/* Solar Loading Animation - Better than Apple's */
@keyframes solar-loading {
    0%, 60%, 100% { 
        opacity: 0.4; 
        transform: scale(0.9); 
        background: var(--solar-ash);
    }
    30% { 
        opacity: 1; 
        transform: scale(1.1); 
        background: var(--solar-flare);
        box-shadow: 0 0 20px var(--solar-flare);
    }
}

/* Modern AI Chat Loading Animation */
@keyframes ai-pulse {
    0%, 60%, 100% { 
        opacity: 0.3; 
        transform: scale(0.8); 
    }
    30% { 
        opacity: 1; 
        transform: scale(1.2); 
    }
}

@keyframes ai-pulse-reduced {
    0%, 50%, 100% { opacity: 0.3; }
    25%, 75% { opacity: 1; }
}

/* ShadCN Layout */
.container { 
    max-width: 1024px; 
    margin: 0 auto; 
    padding: var(--space-8) var(--space-6) var(--space-6); 
    animation: fadeIn 0.5s ease; 
    box-sizing: border-box; 
    width: 100%; 
    position: relative;
}

/* Mobile Responsive Layout */
@media (max-width: 768px) {
    .container {
        max-width: 100%;
        padding: 0;
        margin: 0;
        height: 100vh;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
    }
}
.pill { display: inline-flex; align-items: center; gap: var(--space-2); padding: var(--space-2) var(--space-3); background: var(--dark-surface-2); border: 1px solid var(--dark-border); border-radius: var(--radius-full); font-size: var(--text-xs); color: var(--dark-text-secondary); transition: all var(--transition-fast); }
.pill:hover { background: var(--dark-surface-3); border-color: var(--accent-primary); transform: translateY(-1px); }
.status-indicator { width: 8px; height: 8px; border-radius: 50%; background: var(--accent-success); animation: var(--animation-pulse); }

/* Chat-specific styles */
#chat, #chatArea { 
    height: calc(100vh - 200px); 
    overflow-y: auto; 
    overflow-x: hidden; 
    padding: var(--space-4); 
    padding-right: calc(var(--space-4) + 36px); 
    padding-bottom: 60px; 
    background: var(--dark-surface-1); 
    border: 1px solid var(--dark-border); 
    border-radius: var(--radius-xl); 
    margin-bottom: var(--space-2); 
    scroll-behavior: smooth; 
    position: relative; 
    display: flex; 
    flex-direction: column; 
    gap: var(--space-3); 
    align-items: stretch; 
}

/* Mobile Chat Styles */
@media (max-width: 768px) {
    #chat, #chatArea {
        height: calc(100vh - 60px - 80px);
        padding: var(--space-3);
        padding-right: calc(var(--space-3) + 32px);
        padding-bottom: var(--space-3);
        border-radius: 0;
        margin: 0;
        margin-bottom: var(--space-1);
        border: none;
        overflow-y: auto;
        overflow-x: hidden;
        flex: 1;
    }
}
.bubble { padding: var(--space-3) var(--space-4); margin: var(--space-2) 0; border-radius: var(--radius-xl); animation: fadeIn 0.3s ease; position: relative; overflow: visible; word-wrap: break-word; line-height: 1.6; }
.message-copy-btn { 
  position: absolute; 
  top: var(--space-3); 
  right: -32px; 
  width: 28px; 
  height: 28px; 
  padding: 0; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  background: var(--dark-surface-3); 
  border: 1px solid var(--dark-border); 
  border-radius: var(--radius-md); 
  color: var(--dark-text-secondary); 
  cursor: pointer; 
  opacity: 0.5; 
  transition: all var(--transition-smooth); 
  z-index: 10; 
}
.bubble:hover .message-copy-btn { 
  opacity: 0.8; 
}
.message-copy-btn:hover { 
  background: var(--solar-orange); 
  color: var(--premium-black); 
  transform: scale(1.1); 
  opacity: 1;
  border-color: var(--solar-orange);
  box-shadow: 0 0 12px rgba(255, 107, 53, 0.4);
}
.message-copy-btn.copied { 
  background: var(--solar-orange); 
  color: var(--premium-black); 
  opacity: 1;
  animation: copy-success 0.5s ease;
}
@keyframes copy-success {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}
.bubble.user { 
    background: var(--accent-primary); 
    color: var(--dark-bg); 
    border: none; 
    margin-left: auto; 
    max-width: min(500px, 60%); 
    align-self: flex-end; 
    box-shadow: var(--shadow-subtle); 
    font-family: var(--font-sans);
    font-weight: 500;
}
.bubble.user:hover {
    filter: brightness(1.05);
}
.bubble.assistant { 
    background: var(--dark-surface-2); 
    border: 1px solid var(--dark-border); 
    max-width: min(700px, 75%); 
    position: relative; 
    align-self: flex-start; 
}

/* Mobile Bubble Styles */
@media (max-width: 768px) {
    body .bubble {
        padding: var(--space-3);
        margin: var(--space-2) 0;
        border-radius: var(--radius-lg);
    }
    
    body .bubble.user {
        max-width: 90%;
    }
    
    body .bubble.assistant {
        max-width: 95%;
    }
    
    body .message-copy-btn {
        right: -28px;
        width: 24px;
        height: 24px;
        opacity: 0.5;
    }
    
    body .bubble:hover .message-copy-btn {
        opacity: 0.8;
    }
}
.streaming-text { display: block; }
.typing-cursor { display: inline-block; width: 3px; height: 1.2em; background: var(--accent-primary); animation: typing 1s infinite; margin-left: 2px; vertical-align: text-bottom; }

/* Modern Loading Animation for Chat */
.loading-dots {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-1) var(--space-2);
    min-height: 20px;
}

.loading-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent-primary);
    animation: ai-pulse 1.4s ease-in-out infinite;
}

.loading-dot:nth-child(1) { animation-delay: 0s; }
.loading-dot:nth-child(2) { animation-delay: 0.2s; }
.loading-dot:nth-child(3) { animation-delay: 0.4s; }

/* Accessibility: Respect reduced motion preference */
@media (prefers-reduced-motion: reduce) {
    .loading-dot {
        animation: ai-pulse-reduced 2s ease-in-out infinite;
    }
}

/* Unified Lesson Loading Animation */
.lesson-loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--space-2) var(--space-4);
    background: var(--dark-surface-1);
    border: 1px solid var(--dark-border);
    border-radius: var(--radius-xl);
    margin-bottom: var(--space-6);
    min-height: 40px;
}

.lesson-loading .loading-dots {
    margin-bottom: var(--space-4);
}

.loading-text {
    color: var(--dark-text-secondary);
    font-size: var(--text-sm);
    margin: 0;
    opacity: 0.8;
}

.lesson-loading.hidden {
    display: none;
}

/* Guided Learning-specific styles */
#lessonContentWrapper {
    display: block; /* Force block layout to fix citation overlay */
}
#lesson-content { 
    background: var(--dark-surface-1); 
    border: 1px solid var(--dark-border); 
    border-radius: var(--radius-xl); 
    padding: var(--space-6); 
    margin-bottom: var(--space-6); 
    height: calc(100vh - 200px);
    overflow-y: auto;
}
#enrichment-container { 
    display: flex; 
    flex-direction: column; 
    gap: var(--space-4); 
    margin-bottom: var(--space-6); 
}
.lesson-selector { 
    display: flex; 
    align-items: center; 
    justify-content: space-between; 
    padding: var(--space-3) var(--space-4); 
    background: var(--dark-surface-2); 
    border: 1px solid var(--dark-border); 
    border-radius: var(--radius-lg); 
    margin-bottom: var(--space-6); 
}
.lesson-selector button { 
    background: none; 
    border: 1px solid var(--dark-border); 
    border-radius: var(--radius-md); 
    color: var(--dark-text-secondary); 
    cursor: pointer; 
    padding: var(--space-2); 
    transition: all var(--transition-fast); 
    display: flex; 
    align-items: center; 
    justify-content: center; 
}
.lesson-selector button:hover { 
    background: var(--dark-surface-3); 
    color: var(--dark-text-primary); 
}
.lesson-selector button:disabled { 
    opacity: 0.5; 
    cursor: not-allowed; 
}
.lesson-selector select { 
    background: var(--dark-surface-1); 
    border: 1px solid var(--dark-border); 
    border-radius: var(--radius-md); 
    color: var(--dark-text-primary); 
    padding: var(--space-2) var(--space-3); 
    flex-grow: 1; 
    margin: 0 var(--space-3); 
}

/* Mobile Guided Learning Styles */
@media (max-width: 768px) {
    body #lesson-content {
        padding: var(--space-3);
        border-radius: 0;
        margin: 0;
        border: none;
        height: calc(100vh - 60px - 80px);
        overflow-y: auto;
        flex: 1;
    }
    
    body .lesson-selector {
        padding: var(--space-2) var(--space-3);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-4);
        flex-wrap: wrap;
        gap: var(--space-2);
    }
    
    body .lesson-selector button {
        padding: var(--space-2);
        /* Enhanced touch targets */
        min-width: 44px;
        min-height: 44px;
    }
    
    body .lesson-selector select {
        /* CRITICAL: 16px minimum font size prevents iOS Safari zoom */
        font-size: 16px;
        padding: var(--space-2);
        margin: 0 var(--space-2);
        min-height: 44px;
        flex: 1;
        min-width: 0;
    }
    
    #enrichment-container {
        gap: var(--space-3);
        margin-bottom: var(--space-4);
    }
}
.skeleton-loader { background: var(--dark-surface-2); border-radius: var(--radius-md); background: linear-gradient(110deg, var(--dark-surface-2) 8%, var(--dark-surface-3) 18%, var(--dark-surface-2) 33%); background-size: 200% 100%; animation: var(--animation-shimmer); }
.skeleton-loader.title { height: 36px; width: 40%; margin-bottom: var(--space-6); }
.skeleton-loader.text { height: 20px; width: 100%; margin-bottom: var(--space-3); }
.skeleton-loader.text.short { width: 60%; }

/* Shared Markdown & Component Styles */

/* Premium Code Blocks */
pre {
    background: linear-gradient(135deg, var(--premium-slate) 0%, var(--premium-charcoal) 100%);
    border: 1px solid rgba(255, 107, 53, 0.1);
    border-radius: var(--radius-lg);
    padding: var(--space-5) var(--space-4);
    padding-top: var(--space-6);
    margin: var(--space-4) 0;
    font-family: var(--font-mono);
    font-size: 0.9rem;
    line-height: 1.6;
    position: relative;
    overflow-x: auto;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.02);
}

pre::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--solar-orange), var(--solar-amber), var(--solar-gold));
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

/* Language label for code blocks */
pre[class*="language-"]::after {
    content: attr(data-language);
    position: absolute;
    top: 8px;
    left: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--solar-amber);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    opacity: 0.8;
}

pre.language-java::after { content: 'Java'; }
pre.language-javascript::after { content: 'JavaScript'; }
pre.language-python::after { content: 'Python'; }
pre.language-bash::after { content: 'Bash'; }
pre.language-sql::after { content: 'SQL'; }
pre.language-json::after { content: 'JSON'; }
pre.language-xml::after { content: 'XML'; }

pre code {
    background: transparent;
    padding: 0;
    border: none;
    color: var(--dark-text-primary);
    font-family: var(--font-mono);
    font-size: inherit;
}

/* Inline Code */
code {
    background: linear-gradient(135deg, rgba(255, 107, 53, 0.1) 0%, rgba(255, 140, 66, 0.08) 100%);
    border: 1px solid rgba(255, 107, 53, 0.2);
    border-radius: var(--radius-sm);
    padding: 3px 8px;
    font-family: var(--font-mono);
    font-size: 0.85em;
    color: var(--solar-amber);
    font-weight: 600;
    letter-spacing: 0.02em;
    transition: all var(--transition-smooth);
    white-space: nowrap;
}

code:hover {
    background: linear-gradient(135deg, rgba(255, 107, 53, 0.15) 0%, rgba(255, 140, 66, 0.12) 100%);
    border-color: rgba(255, 107, 53, 0.3);
    transform: translateY(-1px);
}

/* Prism.js syntax highlighting integration */
.language-java .token.keyword { color: var(--solar-orange); font-weight: 700; }
.language-java .token.class-name { color: var(--solar-gold); }
.language-java .token.function { color: var(--solar-amber); }
.language-java .token.string { color: #86efac; }
.language-java .token.number { color: #fbbf24; }
.language-java .token.comment { color: #6b7280; font-style: italic; }
.language-java .token.annotation { color: var(--solar-coral); }
.language-java .token.operator { color: #f472b6; }

.code-copy-btn { 
  position: absolute; 
  top: 8px; 
  right: 8px; 
  width: 28px; 
  height: 28px; 
  padding: 0; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  background: var(--dark-surface-3); 
  border: 1px solid var(--dark-border); 
  border-radius: var(--radius-md); 
  color: var(--dark-text-secondary); 
  cursor: pointer; 
  opacity: 0.5; 
  transition: all var(--transition-smooth); 
  z-index: 2; 
}
pre:hover .code-copy-btn { 
  opacity: 0.8; 
}
.code-copy-btn:hover { 
  background: var(--solar-orange); 
  color: var(--premium-black); 
  transform: scale(1.1); 
  opacity: 1;
  border-color: var(--solar-orange);
  box-shadow: 0 0 12px rgba(255, 107, 53, 0.4);
}
.code-copy-btn.copied { 
  background: var(--solar-orange); 
  color: var(--premium-black); 
  opacity: 1;
  animation: copy-success 0.5s ease;
}
p { margin: 0 0 var(--space-3) 0; line-height: 1.6; }
p:last-child { margin-bottom: 0; }
p:empty { display: none; }
h1, h2, h3, h4, h5, h6 { margin: var(--space-4) 0 var(--space-3) 0; font-weight: 600; line-height: 1.3; }
h1:first-child, h2:first-child, h3:first-child { margin-top: 0; }
h1 { font-size: var(--text-2xl); }
h2 { font-size: var(--text-xl); }
h3 { font-size: var(--text-lg); }
/* Beautiful Lists */
ul, ol { 
  margin: var(--space-4) 0; 
  padding-left: var(--space-6); 
  line-height: 1.8;
  position: relative;
}

ul {
  list-style: none;
}

ul > li {
  position: relative;
  padding-left: var(--space-4);
}

ul > li::before {
  content: '▸';
  position: absolute;
  left: 0;
  color: var(--solar-orange);
  font-weight: 700;
  transition: all var(--transition-smooth);
}

ul > li:hover::before {
  transform: translateX(2px);
  color: var(--solar-amber);
}

ol {
  counter-reset: list-counter;
  list-style: none;
}

ol > li {
  counter-increment: list-counter;
  position: relative;
  padding-left: var(--space-6);
}

ol > li::before {
  content: counter(list-counter) '.';
  position: absolute;
  left: 0;
  color: var(--solar-orange);
  font-weight: 700;
  font-size: 0.9em;
  min-width: var(--space-4);
  text-align: right;
}

li { 
  margin: var(--space-2) 0;
  transition: all var(--transition-smooth);
}

li:hover {
  transform: translateX(2px);
}

/* Nested lists */
ul ul, ol ol, ul ol, ol ul { 
  margin: var(--space-2) 0; 
  padding-left: var(--space-4);
  border-left: 2px solid rgba(255, 107, 53, 0.1);
}

ul ul > li::before {
  content: '◆';
  font-size: 0.8em;
  color: var(--solar-amber);
}

ol ol > li::before {
  content: counter(list-counter, lower-alpha) '.';
}
/* Bold text styling */
strong, b { 
  font-weight: 700; 
  color: var(--dark-text-primary);
  background: linear-gradient(135deg, var(--solar-orange) 0%, var(--solar-amber) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: 0.01em;
}

.bubble strong, .bubble b {
  filter: brightness(1.1);
}
pear em { font-style: normal; }
blockquote { margin: var(--space-3) 0; padding: var(--space-3) var(--space-4); border-left: 3px solid var(--accent-primary); background: var(--dark-surface-3); border-radius: var(--radius-md); }
pre { position: relative; }
div + div, p + p, div + p, p + div, pre + p, p + pre { margin-top: var(--space-3); }
/* List spacing */
p + ol, p + ul { margin-top: var(--space-3); }
ol + pre, ul + pre, li + pre { margin-top: var(--space-4); }
pre + ol, pre + ul, pre + p { margin-top: var(--space-4); }
ol + p, ul + p { margin-top: var(--space-3); }

/* Ensure proper list item spacing was handled in list section above */
.inline-enrichment { margin: var(--space-3) 0; }
.inline-enrichment:first-child { margin-top: 0; }
.inline-enrichment:last-child { margin-bottom: 0; }
.inline-enrichment { 
  margin: var(--space-4) 0; 
  padding: var(--space-4); 
  border-radius: var(--radius-lg); 
  border: 1px solid transparent;
  background: var(--dark-surface-1); 
  position: relative;
  overflow: hidden;
  transition: all var(--transition-smooth);
  animation: enrichmentSlide 0.5s ease-out;
}

@keyframes enrichmentSlide {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.inline-enrichment::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  bottom: 0;
  width: 4px;
  transition: width var(--transition-smooth);
}

.inline-enrichment:hover::before {
  width: 6px;
}

.inline-enrichment-header { 
  display: flex; 
  align-items: center; 
  gap: var(--space-2); 
  margin-bottom: var(--space-3); 
  font-weight: 600;
  font-size: 0.9rem;
  letter-spacing: 0.02em;
  text-transform: uppercase;
  opacity: 0.9;
}

.inline-enrichment-header svg { 
  width: 18px; 
  height: 18px;
  transition: transform var(--transition-smooth);
}

.inline-enrichment:hover .inline-enrichment-header svg {
  transform: rotate(-5deg) scale(1.1);
}
.inline-enrichment.hint { 
  background: linear-gradient(135deg, rgba(255, 140, 66, 0.08) 0%, rgba(255, 107, 53, 0.05) 100%);
  border: 1px solid rgba(255, 140, 66, 0.15);
  color: var(--dark-text-primary); 
  box-shadow: 0 2px 12px rgba(255, 140, 66, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.02);
}

.inline-enrichment.hint::before {
  background: linear-gradient(180deg, var(--solar-amber) 0%, var(--solar-orange) 100%);
}

.inline-enrichment.hint .inline-enrichment-header { 
  color: var(--solar-amber);
  filter: brightness(1.1);
}

.inline-enrichment.hint:hover {
  background: linear-gradient(135deg, rgba(255, 140, 66, 0.12) 0%, rgba(255, 107, 53, 0.08) 100%);
  border-color: rgba(255, 140, 66, 0.25);
  transform: translateX(2px);
}
.inline-enrichment.reminder { 
  background: linear-gradient(135deg, rgba(250, 204, 21, 0.08) 0%, rgba(245, 158, 11, 0.05) 100%);
  border: 1px solid rgba(250, 204, 21, 0.15);
  color: var(--dark-text-primary);
  box-shadow: 0 2px 12px rgba(250, 204, 21, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.02);
}

.inline-enrichment.reminder::before {
  background: linear-gradient(180deg, #fbbf24 0%, #f59e0b 100%);
}

.inline-enrichment.reminder .inline-enrichment-header { 
  color: #fbbf24;
  filter: brightness(1.1);
}

.inline-enrichment.reminder:hover {
  background: linear-gradient(135deg, rgba(250, 204, 21, 0.12) 0%, rgba(245, 158, 11, 0.08) 100%);
  border-color: rgba(250, 204, 21, 0.25);
  transform: translateX(2px);
}
.inline-enrichment.background { 
  background: linear-gradient(135deg, rgba(34, 197, 94, 0.08) 0%, rgba(16, 185, 129, 0.05) 100%);
  border: 1px solid rgba(34, 197, 94, 0.15);
  color: var(--dark-text-primary);
  box-shadow: 0 2px 12px rgba(34, 197, 94, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.02);
}

.inline-enrichment.background::before {
  background: linear-gradient(180deg, #22c55e 0%, #10b981 100%);
}

.inline-enrichment.background .inline-enrichment-header { 
  color: #22c55e;
  filter: brightness(1.1);
}

.inline-enrichment.background:hover {
  background: linear-gradient(135deg, rgba(34, 197, 94, 0.12) 0%, rgba(16, 185, 129, 0.08) 100%);
  border-color: rgba(34, 197, 94, 0.25);
  transform: translateX(2px);
}
.inline-enrichment.warning { 
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(220, 38, 38, 0.05) 100%);
  border: 1px solid rgba(239, 68, 68, 0.15);
  color: var(--dark-text-primary);
  box-shadow: 0 2px 12px rgba(239, 68, 68, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.02);
}

.inline-enrichment.warning::before {
  background: linear-gradient(180deg, #ef4444 0%, #dc2626 100%);
}

.inline-enrichment.warning .inline-enrichment-header { 
  color: #ef4444;
  filter: brightness(1.1);
}

.inline-enrichment.warning:hover {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.12) 0%, rgba(220, 38, 38, 0.08) 100%);
  border-color: rgba(239, 68, 68, 0.25);
  transform: translateX(2px);
}
.enrichment-text { 
  display: block; 
  color: var(--dark-text-primary); 
  margin: 0;
  line-height: 1.6;
  opacity: 0.95;
}
.inline-enrichment.example { 
  background: linear-gradient(135deg, rgba(168, 85, 247, 0.08) 0%, rgba(139, 92, 246, 0.05) 100%);
  border: 1px solid rgba(168, 85, 247, 0.15);
  color: var(--dark-text-primary);
  box-shadow: 0 2px 12px rgba(168, 85, 247, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.02);
}

.inline-enrichment.example::before {
  background: linear-gradient(180deg, #a855f7 0%, #8b5cf6 100%);
}

.inline-enrichment.example .inline-enrichment-header { 
  color: #a855f7;
  filter: brightness(1.1);
}

.inline-enrichment.example:hover {
  background: linear-gradient(135deg, rgba(168, 85, 247, 0.12) 0%, rgba(139, 92, 246, 0.08) 100%);
  border-color: rgba(168, 85, 247, 0.25);
  transform: translateX(2px);
}
.inline-enrichment.example pre { 
  margin: var(--space-2) 0 0 0; 
  background: var(--dark-surface-3); 
  border: 1px solid var(--dark-border); 
  border-radius: var(--radius-md);
  padding: var(--space-3);
}

/* Citations */
@keyframes pillFadeIn {
    from {
        opacity: 0;
        transform: translateY(8px) scale(0.9);
        filter: blur(2px);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
        filter: blur(0);
    }
}

.citations-row {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-3);
    padding: var(--space-3) 0;
    margin-bottom: var(--space-4);
    border-bottom: 1px solid rgba(255, 107, 53, 0.08);
    /* Ensure citations don't interfere with copy button positioning */
    max-width: calc(100% - 40px); /* Leave space for copy button */
    box-sizing: border-box;
    align-items: center;
    position: relative;
}

.citations-row::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--solar-orange), transparent);
    opacity: 0.2;
}

/* Hide citations in guided learning specifically - use class-based approach for better browser support */
/* Citations are shown in both Chat and Guided for parity */

.citation-pill {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-2) var(--space-4);
    background: linear-gradient(135deg, var(--premium-slate) 0%, var(--premium-graphite) 100%);
    border: 1px solid rgba(255, 107, 53, 0.1);
    border-radius: var(--radius-full);
    font-size: 0.8rem;
    color: var(--dark-text-secondary);
    text-decoration: none;
    transition: all var(--transition-smooth);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.03);
    position: relative;
    overflow: hidden;
    animation: pillFadeIn 0.5s ease-out;
    font-weight: 500;
    letter-spacing: 0.01em;
    min-width: -webkit-fill-available;
    min-width: fit-content;
    max-width: 100%;
}

.citation-pill::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.15), transparent);
    transform: translateX(-100%);
    transition: transform 0.6s ease;
    pointer-events: none;
}

.citation-pill:hover {
    background: linear-gradient(135deg, var(--solar-orange) 0%, var(--solar-amber) 100%);
    border-color: var(--solar-orange);
    color: white;
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.citation-pill:hover::before {
    transform: translateX(100%);
}

.citation-icon {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
    opacity: 0.8;
    transition: all var(--transition-smooth);
    filter: grayscale(0.3);
}

.citation-pill:hover .citation-icon {
    opacity: 1;
    filter: grayscale(0) brightness(1.2);
    transform: rotate(-5deg);
}

.citation-number {
    font-weight: 700;
    font-size: 0.75rem;
    background: linear-gradient(135deg, rgba(255, 107, 53, 0.15) 0%, rgba(255, 140, 66, 0.15) 100%);
    color: var(--solar-amber);
    padding: 1px 5px;
    border-radius: var(--radius-sm);
    margin-right: 6px;
    min-width: 20px;
    text-align: center;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 1px solid rgba(255, 107, 53, 0.15);
    transition: all var(--transition-smooth);
    flex-shrink: 0;
}

.citation-pill:hover .citation-number {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border-color: rgba(255, 255, 255, 0.3);
}

.citation-label {
    flex: 0 1 auto;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    max-width: 300px;
    transition: all var(--transition-smooth);
}

.citation-pill:hover .citation-label {
    letter-spacing: 0.02em;
}

/* Inline link styling - appears inline within text content */
.citation-pill.inline-link {
    display: inline-flex;
    margin: 0 var(--space-1);
    padding: 3px 10px;
    font-size: 0.85em;
    background: linear-gradient(135deg, rgba(255, 107, 53, 0.08) 0%, rgba(255, 140, 66, 0.08) 100%);
    border: 1px solid rgba(255, 107, 53, 0.2);
    color: var(--solar-amber);
    box-shadow: 0 1px 3px rgba(255, 107, 53, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.05);
    font-weight: 600;
    letter-spacing: 0.01em;
    vertical-align: baseline;
    transition: all var(--transition-smooth);
}

.citation-pill.inline-link:hover {
    background: var(--gradient-solar);
    color: white;
    border-color: var(--solar-orange);
    box-shadow: 0 3px 12px rgba(255, 107, 53, 0.35), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    transform: translateY(-1px) scale(1.02);
    padding: 3px 12px;
}

.citation-pill.inline-link .citation-icon {
    width: 12px;
    height: 12px;
    margin-right: 2px;
}

.citation-pill.inline-link:hover .citation-icon {
    transform: rotate(-8deg) scale(1.1);
}

/* PDF-specific styling */
.citation-pill-pdf {
    background: linear-gradient(135deg, rgba(220, 38, 38, 0.1) 0%, rgba(239, 68, 68, 0.1) 100%);
    border-color: rgba(220, 38, 38, 0.2);
    color: #ef4444;
}

.citation-pill-pdf .citation-icon {
    filter: hue-rotate(-10deg);
}

.citation-pill-pdf:hover {
    background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
    border-color: #dc2626;
    color: white;
    box-shadow: 0 6px 20px rgba(220, 38, 38, 0.3);
}

/* Web link specific styling */
.citation-pill[href^="http"] {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(96, 165, 250, 0.08) 100%);
    border-color: rgba(59, 130, 246, 0.2);
    color: #60a5fa;
}

.citation-pill[href^="http"]:hover {
    background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%);
    border-color: #3b82f6;
    color: white;
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.3);
}

/* Skeleton loader fix */
.skeleton-loader.hidden, #lessonSkeleton.hidden { display: none; }
.skeleton-loader { width: 100%; }
.skeleton-line { height: 1em; background: var(--dark-surface-3); border-radius: var(--radius-sm); margin-bottom: 0.75em; opacity: 0.5; }

/* Input Area */
.input-area { 
    background: var(--dark-surface-1); 
    border: 1px solid var(--dark-border); 
    border-radius: var(--radius-xl); 
    padding: var(--space-4); 
    margin-top: var(--space-4); 
    width: 100%; 
    box-sizing: border-box; 
    overflow: hidden; 
    box-shadow: var(--shadow-md), 0 0 0 1px rgba(255, 255, 255, 0.02);
    transition: all var(--transition-base);
    animation: slideUp 0.3s ease-out;
}
.input-area:hover {
    box-shadow: var(--shadow-lg), 0 0 0 1px rgba(255, 255, 255, 0.03);
    border-color: var(--dark-border-hover, #3a3a4a);
}
@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
.input-row { 
    display: flex; 
    gap: var(--space-3); 
    align-items: center; 
    width: 100%; 
    box-sizing: border-box; 
}
.input-wrapper { 
    flex: 1; 
    position: relative; 
    min-width: 0; 
    box-sizing: border-box; 
}
/* ShadCN Input */
.input { 
    width: 100%; 
    padding: var(--space-3) 50px var(--space-3) var(--space-4); 
    background: var(--dark-surface-2); 
    border: 1px solid transparent; 
    border-radius: var(--radius-md); 
    color: var(--dark-text-primary); 
    font-size: var(--text-base); 
    font-family: var(--font-sans); 
    transition: all var(--transition-base); 
    outline: none; 
    box-sizing: border-box; 
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.05);
}
.input:focus { 
    border-color: var(--accent-primary); 
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1), 0 0 0 2px rgba(255, 140, 66, 0.3); 
    background: var(--dark-surface-3); 
}
.input:not(:focus) {
    border-color: transparent;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.05);
}
.input::placeholder {
    color: var(--dark-text-tertiary);
    opacity: 0.7;
}

/* Mobile Developer Terminal - iOS Safari optimized */
@media (max-width: 768px) {
    body .input-area {
        padding: var(--space-3);
        border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        margin: 0;
        border: 1px solid var(--dark-border);
        border-bottom: none;
        position: fixed;
        bottom: 0;
        left: var(--space-2);
        right: var(--space-2);
        z-index: 10;
        flex-shrink: 0;
        background: var(--dark-surface-1);
        box-shadow: var(--shadow-lg), 0 0 0 1px rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px);
        max-width: calc(100% - var(--space-4));
        margin: 0 auto;
    }
    
    body .input {
        /* CRITICAL: 16px minimum font size prevents iOS Safari zoom */
        font-size: 16px;
        padding: var(--space-3) 44px var(--space-3) var(--space-3);
        border-radius: var(--radius-md);
        /* Enhanced touch target */
        min-height: 44px;
        font-family: var(--font-mono-code);
        font-weight: 450;
    }
    
    body .input-wrapper .btn {
        width: 36px;
        height: 36px;
        right: 4px;
        font-size: 16px;
    }
}
/* ShadCN Button */
.input-wrapper .btn {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    background: var(--accent-primary);
    color: var(--dark-bg);
    border: none;
    border-radius: var(--radius-md);
    width: 32px;
    height: 32px;
    padding: 0;
    cursor: pointer;
    transition: all var(--transition-base);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
.input-wrapper .btn:hover { 
    background: #f59e0b; 
    transform: translateY(-50%) scale(1.05); 
    box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
}
.input-wrapper .btn:active {
    transform: translateY(-50%) scale(0.95);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Export button */
/* Chat action buttons container */
.chat-actions {
  position: fixed;
  bottom: 100px;
  right: var(--space-4);
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  z-index: 50;
}

.export-chat-btn { 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  background: var(--dark-surface-3); 
  border: 1px solid var(--dark-border); 
  border-radius: var(--radius-full); 
  padding: 10px 12px; 
  color: var(--dark-text-secondary); 
  cursor: pointer; 
  box-shadow: var(--shadow-md); 
  transition: all var(--transition-fast);
  opacity: 0;
  visibility: hidden;
  transform: translateX(10px);
}
.export-chat-btn.visible {
  opacity: 1;
  visibility: visible;
  transform: translateX(0);
}
.export-chat-btn:hover { 
  background: var(--accent-primary); 
  color: white; 
  transform: scale(1.05); 
  box-shadow: var(--shadow-lg); 
}
.export-chat-btn::after { 
  content: 'Copy all messages'; 
  position: absolute; 
  bottom: calc(100% + 8px); 
  left: 50%; 
  transform: translateX(-50%); 
  white-space: nowrap; 
  background: var(--dark-surface-2); 
  border: 1px solid var(--dark-border); 
  padding: 6px 10px; 
  border-radius: var(--radius-md); 
  font-size: var(--text-xs); 
  color: var(--dark-text-secondary); 
  opacity: 0; 
  pointer-events: none; 
  transition: all var(--transition-fast); 
  z-index: 20;
}
.export-chat-btn.visible:hover::after { 
  opacity: 1; 
  transform: translateX(-50%) translateY(-2px); 
}

/* Scroll indicator button */
.scroll-indicator {
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--solar-orange);
  border: 1px solid var(--solar-orange);
  border-radius: var(--radius-full);
  padding: 10px 12px;
  color: var(--premium-black);
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
  transition: all var(--transition-smooth);
  position: relative;
  animation: bounceGentle 3s ease-in-out infinite;
  opacity: 0.9;
}

.scroll-indicator svg {
  stroke: var(--premium-black);
  fill: none;
}

.scroll-indicator::after {
  content: '';
  position: absolute;
  inset: -4px;
  border-radius: var(--radius-full);
  background: var(--gradient-solar);
  opacity: 0.3;
  z-index: -1;
  animation: pulseGlow 2s ease-in-out infinite;
}

@keyframes pulseGlow {
  0%, 100% { transform: scale(1); opacity: 0.3; }
  50% { transform: scale(1.1); opacity: 0.1; }
}

.scroll-indicator:hover {
  background: var(--solar-amber);
  border-color: var(--solar-amber);
  transform: scale(1.1) translateY(-2px);
  box-shadow: 0 6px 20px rgba(255, 140, 66, 0.5);
  animation-play-state: paused;
  opacity: 1;
}

.scroll-indicator:active {
  transform: scale(1.05) translateY(0);
}

@keyframes bounceGentle {
  0%, 100% { transform: translateY(0); }
  25% { transform: translateY(-3px); }
  75% { transform: translateY(3px); }
}


/* Mobile Safety Measures & Touch Optimization */
@media (max-width: 768px) {
    /* Prevent horizontal scrolling and body scroll */
    body {
        overflow: hidden;
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
        text-size-adjust: 100%;
        height: 100vh;
        position: fixed;
        width: 100%;
    }
    
    /* Enhanced touch targets for all interactive elements */
    button, .btn, .citation-pill, .message-copy-btn, .code-copy-btn {
        min-height: 44px;
        min-width: 44px;
        /* Improve touch feedback */
        -webkit-tap-highlight-color: rgba(102, 126, 234, 0.3);
    }
    
    /* Prevent zoom on double-tap for specific elements */
    .bubble, .input-area, #chat, #lesson-content {
        touch-action: manipulation;
    }
    
    /* Improve scrolling performance */
    #chat, #lesson-content {
        scroll-behavior: smooth;
        /* Legacy iOS support */
        -webkit-overflow-scrolling: touch;
    }
    
    /* Ensure code blocks are horizontally scrollable */
    pre {
        overflow-x: auto;
        max-width: 100%;
        /* Legacy iOS support */
        -webkit-overflow-scrolling: touch;
    }
    
    /* Better text selection on mobile */
    .bubble, #lesson-content {
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
    }
    
    /* Improve citation pill touch targets */
    .citation-pill {
        padding: var(--space-2) var(--space-3);
        margin: var(--space-1);
        min-height: 36px;
        font-size: 0.85rem;
    }
    
    .citation-label {
        max-width: 200px;
    }
    
    .citation-number {
        font-size: 0.7em;
        padding: 1px 4px;
        min-width: 16px;
    }
    
    .citation-label {
        max-width: 120px;
        font-size: 0.9em;
    }
    
    /* Better export button positioning */
    .chat-actions {
        bottom: 75px;
        right: var(--space-2);
        gap: var(--space-2);
    }
    
    .export-chat-btn,
    .scroll-indicator {
        padding: 8px 10px;
        min-height: 36px;
        min-width: 36px;
    }
    
    /* Responsive typography */
    h1 { font-size: 1.5rem; }
    h2 { font-size: 1.25rem; }
    h3 { font-size: 1.125rem; }
    
    /* Subtle loading animation on mobile */
    .loading-dots {
        padding: var(--space-1);
        min-height: 16px;
    }
    
    .loading-dot {
        width: 4px;
        height: 4px;
        opacity: 0.6;
    }
}

/* Tablet-specific optimizations */
@media (min-width: 769px) and (max-width: 1024px) {
    .container {
        padding: var(--space-6) var(--space-4) var(--space-4);
    }
    
    .bubble.user {
        max-width: 70%;
    }
    
    .bubble.assistant {
        max-width: 80%;
    }
}

/* Mobile Performance & Safety Optimizations */
@media (max-width: 768px) {
    /* Prevent layout shifts during loading */
    .container {
        contain: layout style;
    }
    
    /* Optimize animations for mobile */
    * {
        will-change: auto;
    }
    
    /* Reduce motion for accessibility */
            @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms;
                animation-iteration-count: 1;
                transition-duration: 0.01ms;
    }
}

/* Coffee Shop Syntax Highlighting Theme */
.code-block {
    background: var(--dark-surface-2);
    border: 1px solid var(--dark-border);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    margin: var(--space-3) 0;
    font-family: var(--font-mono-code);
    font-size: 0.9rem;
    line-height: 1.6;
    overflow-x: auto;
    position: relative;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.05), 0 4px 8px rgba(0,0,0,0.3);
}

.code-block::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, var(--solar-flare), var(--coffee-foam), var(--solar-gold));
    opacity: 0.6;
}

/* Coffee-themed syntax colors */
.token.comment { color: var(--coffee-crema); }
.token.keyword { color: var(--solar-flare); font-weight: 600; }
.token.string { color: var(--solar-ice); }
.token.function { color: var(--coffee-foam); }
.token.number { color: var(--solar-gold); }
.token.operator { color: var(--solar-coral); }
.token.class-name { color: var(--solar-lime); font-weight: 600; }
.token.variable { color: var(--dark-text-secondary); }

/* Coffee steam effect for code blocks */
.code-block::after {
    content: '';
    position: absolute;
    top: -10px;
    right: 20px;
    width: 30px;
    height: 30px;
    background: radial-gradient(circle, rgba(212, 165, 116, 0.1) 0%, transparent 70%);
    border-radius: 50%;
    animation: code-steam 4s ease-in-out infinite;
    pointer-events: none;
}

@keyframes code-steam {
    0%, 100% { opacity: 0; transform: translateY(0) scale(0.8); }
    50% { opacity: 0.6; transform: translateY(-5px) scale(1); }
}

/* Developer Status Bar */
.status-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 24px;
    background: var(--espresso-black);
    border-top: 1px solid var(--dark-border);
    display: flex;
    align-items: center;
    padding: 0 var(--space-4);
    font-family: var(--font-mono-code);
    font-size: 12px;
    color: var(--coffee-crema);
    z-index: 100;
    backdrop-filter: blur(10px);
}

.status-item {
    margin-right: var(--space-4);
    display: flex;
    align-items: center;
    gap: 6px;
}

.status-indicator {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--solar-lime);
    animation: terminal-blink 2s ease-in-out infinite;
}

@keyframes terminal-blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}
    
    /* Prevent text inflation on some mobile browsers */
    .bubble, .input, .lesson-selector select {
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
    }
    
    /* Improve focus visibility for keyboard navigation */
    button:focus-visible, .btn:focus-visible, .input:focus-visible {
        outline: 2px solid var(--accent-primary);
        outline-offset: 2px;
    }
    
    /* Ensure proper stacking context for mobile */
    .message-copy-btn, .code-copy-btn {
        z-index: 10;
    }
    
    /* Safe area insets for devices with notches */
    .container {
        padding-left: max(var(--space-3), env(safe-area-inset-left));
        padding-right: max(var(--space-3), env(safe-area-inset-right));
        padding-bottom: max(var(--space-3), env(safe-area-inset-bottom));
    }
}

/* Two-Lane Rendering Styles */
.two-lane-container {
    position: relative;
    width: 100%;
}

.parsed-block {
    /* Individual committed block */
    contain: content; /* Performance optimization */
    margin-bottom: var(--space-2);
}

.ephemeral-typing {
    /* Raw text typing area */
    font-family: var(--font-display);
    color: var(--text-secondary);
    opacity: 0.8;
    min-height: 1.2em; /* Prevent layout shift */
    position: relative;
}

.ephemeral-typing .typing-cursor {
    /* Cursor appears in ephemeral text */
    animation: blink 1s infinite;
}

/* Performance optimization for long transcripts */
.parsed-block {
    content-visibility: auto;
    contain-intrinsic-size: auto 400px;
}

/* Utility */
.hidden { display: none; }
.visually-hidden { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }

/* Dev diagnostics (dev-only; harmless in prod) */
.dev-diagnostics { 
  margin-bottom: var(--space-3);
  display: flex;
  gap: var(--space-3);
  flex-wrap: wrap;
}
.dev-panel {
  background: var(--dark-surface-2);
  border: 1px solid var(--dark-border);
  border-radius: var(--radius-lg);
  padding: var(--space-3);
  color: var(--dark-text-primary);
}
.dev-panel > summary {
  cursor: pointer;
  font-weight: 600;
  color: var(--dark-text-secondary);
}
.dev-pre {
  max-height: 220px;
  overflow: auto;
  margin-top: var(--space-2);
  color: var(--dark-text-primary);
  background: var(--dark-surface-1);
  border: 1px solid var(--dark-border);
  border-radius: var(--radius-md);
  padding: var(--space-3);
}
.dev-rag .rag-doc { margin-bottom: var(--space-3); }
.dev-rag .rag-doc-head { display: flex; align-items: center; gap: var(--space-2); margin-bottom: var(--space-2); }
.dev-rag .rag-num { 
  display: inline-flex; align-items: center; justify-content: center; 
  width: 22px; height: 22px; border-radius: var(--radius-full); 
  background: var(--solar-orange); color: var(--premium-black); font-weight: 700; font-size: 12px;
}
/* Ensure anchor pills inside dev panels are always legible */
.dev-panel a.citation-pill {
  color: var(--dark-text-secondary);
}
.dev-panel a.citation-pill:hover {
  color: #fff;
}
