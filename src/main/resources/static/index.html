<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Java Chat â€” Tabs</title>
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196" />
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="/favicon-128.png" sizes="128x128" />
  <link rel="icon" href="/favicon.ico" />
  <meta name="application-name" content="Java Chat"/>
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="/mstile-144x144.png" />
  <meta name="msapplication-square70x70logo" content="/mstile-70x70.png" />
  <meta name="msapplication-square150x150logo" content="/mstile-150x150.png" />
  <meta name="msapplication-wide310x150logo" content="/mstile-310x150.png" />
  <meta name="msapplication-square310x310logo" content="/mstile-310x310.png" />
  <style>
    :root {
      --accent-primary: #667eea;
      --accent-secondary: #764ba2;
      --dark-bg: #0b0d0f;
      --dark-surface-1: #111318;
      --dark-surface-2: #1a1d23;
      --dark-border: #2a2f36;
      --dark-text-primary: #f1f5f9;
      --dark-text-secondary: #cbd5e1;
      --radius-full: 9999px;
      --radius-lg: 12px;
      --space-2: 0.5rem;
      --space-3: 0.75rem;
      --space-4: 1rem;
      --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
      --transition-fast: 150ms ease;
    }

    html, body { height: 100%; }
    body { margin: 0; background: var(--dark-bg); color: var(--dark-text-primary); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .wrap { display: flex; flex-direction: column; height: 100vh; }

    /* Tabs */
    .tabs { display: flex; gap: 8px; padding: var(--space-3); background: var(--dark-surface-2); border-bottom: 1px solid var(--dark-border); position: sticky; top: 0; z-index: 10; }
    .tab { appearance: none; border: 1px solid var(--dark-border); background: #171a20; color: var(--dark-text-secondary); padding: 8px 14px; border-radius: var(--radius-full); cursor: pointer; transition: all var(--transition-fast); font-weight: 500; }
    .tab:hover { border-color: var(--accent-primary); color: #fff; }
    .tab[aria-selected="true"] { background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary)); color: #fff; border-color: transparent; box-shadow: var(--shadow-md); }

    /* Panel */
    .panel { flex: 1; position: relative; }
    .frame { position: absolute; inset: 0; width: 100%; height: 100%; border: none; background: var(--dark-surface-1); }

    /* Basic a11y focus */
    .tab:focus { outline: 2px solid var(--accent-primary); outline-offset: 2px; }

    /* Loader overlay - FIXED to prevent overlapping */
    .loader-overlay { 
      position:absolute; 
      inset:0; 
      display:none; 
      align-items:center; 
      justify-content:center; 
      background: var(--dark-bg); /* Solid background to prevent see-through */
      z-index: 1000; /* Ensure it's on top */
      opacity: 0;
      transition: opacity 200ms ease;
    }
    .loader-overlay.show { 
      display:flex; 
      opacity: 1;
    }
    .loader {
      display: grid; gap: 10px; width: min(600px, 80%);
    }
    .shimmer { position: relative; overflow: hidden; background: #1a1d23; border:1px solid var(--dark-border); border-radius: 10px; }
    .shimmer::before { content:""; position:absolute; inset:0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent); transform: translateX(-100%); animation: shimmer 1.6s infinite; }
    @keyframes shimmer { 0% { transform: translateX(-100%);} 100% { transform: translateX(100%);} }
    .shimmer.small { height: 12px; }
    .shimmer.medium { height: 16px; }
    .shimmer.large { height: 42px; }
    .row-2 { height: 72px; }
    .rounded { border-radius: 9999px; }
    .pad { padding: 14px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="tabs" role="tablist" aria-label="Java Chat Sections">
      <button id="tab-chat" class="tab" role="tab" aria-selected="true" aria-controls="tabpanel" tabindex="0">Chat</button>
      <button id="tab-guided" class="tab" role="tab" aria-selected="false" aria-controls="tabpanel" tabindex="-1">Guided Learning</button>
    </div>

    <div id="tabpanel" class="panel" role="tabpanel" tabindex="0" aria-labelledby="tab-chat">
      <iframe id="contentFrame" class="frame" title="Content"></iframe>
      <div id="loader" class="loader-overlay" aria-hidden="true">
        <div class="loader" aria-label="Loading content">
          <div class="shimmer large pad"></div>
          <div class="shimmer medium rounded"></div>
          <div class="shimmer small rounded"></div>
          <div class="shimmer row-2 pad"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const frame = document.getElementById('contentFrame');
    const loader = document.getElementById('loader');
    const tabs = [
      { id: 'tab-chat', url: 'chat.html' },
      { id: 'tab-guided', url: 'guided.html' }
    ];

    let loaderTimeout = null;
    
    function setActiveTab(targetId) {
      tabs.forEach(({ id, url }) => {
        const el = document.getElementById(id);
        const isActive = id === targetId;
        el.setAttribute('aria-selected', String(isActive));
        el.tabIndex = isActive ? 0 : -1;
        if (isActive) {
          document.getElementById('tabpanel').setAttribute('aria-labelledby', id);
          
          // Only show loader after a small delay to prevent flash for fast loads
          if (loaderTimeout) clearTimeout(loaderTimeout);
          loaderTimeout = setTimeout(() => showLoader(true), 100);
          
          // Clear iframe first to prevent stale content flash
          frame.style.visibility = 'hidden';
          frame.src = url;
          
          // reflect in hash for deep-linking
          const hash = id === 'tab-guided' ? '#guided' : '#chat';
          if (location.hash !== hash) history.replaceState(null, '', hash);
        }
      });
    }

    // Click handlers
    tabs.forEach(({ id }) => {
      document.getElementById(id).addEventListener('click', () => setActiveTab(id));
    });

    // Keyboard navigation (Left/Right)
    document.querySelector('.tabs').addEventListener('keydown', (e) => {
      const order = tabs.map(t => t.id);
      const activeIdx = order.findIndex(id => document.getElementById(id).getAttribute('aria-selected') === 'true');
      if (e.key === 'ArrowRight') {
        e.preventDefault();
        const next = order[(activeIdx + 1) % order.length];
        setActiveTab(next);
        document.getElementById(next).focus();
      } else if (e.key === 'ArrowLeft') {
        e.preventDefault();
        const prev = order[(activeIdx - 1 + order.length) % order.length];
        setActiveTab(prev);
        document.getElementById(prev).focus();
      }
    });

    // Hide loader when iframe finishes loading
    frame.addEventListener('load', () => {
      // Cancel pending loader if it hasn't shown yet
      if (loaderTimeout) {
        clearTimeout(loaderTimeout);
        loaderTimeout = null;
      }
      // Small delay to ensure content is painted
      setTimeout(() => {
        showLoader(false);
        frame.style.visibility = 'visible';
      }, 50);
    });

    // Immediately hide loader when inner page signals readiness
    window.addEventListener('message', (e) => {
      const data = e && e.data;
      if (!data || typeof data !== 'object') return;
      
      if (data.type === 'content-started' || data.type === 'content-ready' || data.type === 'dom-ready') {
        // Cancel pending loader
        if (loaderTimeout) {
          clearTimeout(loaderTimeout);
          loaderTimeout = null;
        }
        // Hide loader immediately
        showLoader(false);
        frame.style.visibility = 'visible';
      }
    });

    function showLoader(show) {
      const panel = document.getElementById('tabpanel');
      if (show) {
        loader.classList.add('show');
        panel.setAttribute('aria-busy', 'true');
      } else {
        loader.classList.remove('show');
        panel.setAttribute('aria-busy', 'false');
      }
    }

    // Initial tab selection from hash
    function initialTab() {
      const h = (location.hash || '').toLowerCase();
      if (h.includes('guided')) return 'tab-guided';
      return 'tab-chat';
    }

    // Initialize
    setActiveTab(initialTab());
  </script>
</body>
</html>
