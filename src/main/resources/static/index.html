<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Java Chat — Tabs</title>
  <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196" />
  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="/favicon-128.png" sizes="128x128" />
  <link rel="icon" href="/favicon.ico" />
  <meta name="application-name" content="Java Chat"/>
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="/mstile-144x144.png" />
  <meta name="msapplication-square70x70logo" content="/mstile-70x70.png" />
  <meta name="msapplication-square150x150logo" content="/mstile-150x150.png" />
  <meta name="msapplication-wide310x150logo" content="/mstile-310x150.png" />
  <meta name="msapplication-square310x310logo" content="/mstile-310x310.png" />
  <style>
     :root {
       /* SOLAR ROAST THEME - Developer Nirvana */
       /* Coffee Colors */
       --espresso-black: #0a0a0a;
       --coffee-foam: #d4a574;
       --coffee-bean: #3e2723;
       --coffee-steam: #f5f5dc;
       --coffee-crema: #c5a78e;
       
       /* Solar Colors */
       --solar-flare: #ff8c42;
       --solar-lime: #ccff00;
       --solar-coral: #ff4757;
       --solar-ice: #00d2d3;
       --solar-gold: #ffb347;
       
       /* Developer Colors */
       --code-black: #0d1117;
       --code-gray: #161b22;
       --code-comment: #8b949e;
       --code-green: #238636;
       --code-blue: #58a6ff;
       
       /* Theme Variables */
       --accent-primary: var(--solar-flare);
       --accent-secondary: var(--solar-lime);
       --accent-tertiary: var(--solar-coral);
       --accent-quaternary: var(--solar-ice);
       --dark-bg: var(--espresso-black);
       --dark-surface-1: var(--code-black);
       --dark-surface-2: var(--code-gray);
       --dark-surface-3: #21262d;
       --dark-border: #30363d;
       --dark-text-primary: #f0f6fc;
       --dark-text-secondary: #c9d1d9;
       --dark-text-tertiary: #8b949e;
       
       /* Developer Typography */
       --font-mono-display: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', ui-monospace, SFMono-Regular, monospace;
       --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
       --font-mono-code: 'Cascadia Code', 'JetBrains Mono', 'Fira Code', ui-monospace, monospace;
       
       /* Coffee Glow Effects */
       --glow-primary: 0 0 25px rgba(255, 140, 66, 0.6);
       --glow-secondary: 0 0 25px rgba(204, 255, 0, 0.5);
       --glow-tertiary: 0 0 25px rgba(255, 71, 87, 0.5);
       --glow-quaternary: 0 0 25px rgba(0, 210, 211, 0.5);
       --glow-coffee: 0 0 20px rgba(212, 165, 116, 0.4);
       
       /* Coffee Gradients */
       --gradient-primary: linear-gradient(135deg, var(--solar-flare) 0%, var(--coffee-foam) 50%, var(--solar-gold) 100%);
       --gradient-secondary: linear-gradient(45deg, var(--solar-lime) 0%, var(--solar-ice) 100%);
       --gradient-tertiary: linear-gradient(90deg, var(--solar-coral) 0%, var(--solar-flare) 100%);
       --gradient-coffee: linear-gradient(180deg, var(--coffee-bean) 0%, var(--espresso-black) 100%);
       --gradient-steam: linear-gradient(45deg, rgba(245, 245, 220, 0.1) 0%, rgba(212, 165, 116, 0.2) 100%);
       
       /* Coffee Animations */
       --coffee-brew-duration: 4s;
       --steam-rise-duration: 3s;
       --roast-flip-duration: 2s;
       
       --radius-full: 9999px;
       --radius-lg: 12px;
       --space-2: 0.5rem;
       --space-3: 0.75rem;
       --space-4: 1rem;
       --shadow-md: 0 8px 16px rgba(0,0,0,0.6);
       --transition-fast: 200ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
       --transition-coffee: 400ms cubic-bezier(0.23, 1, 0.32, 1);
       --transition-code: 150ms cubic-bezier(0.4, 0, 0.2, 1);
     }

    html, body { height: 100%; }
    body { margin: 0; background: var(--dark-bg); color: var(--dark-text-primary); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .wrap { display: flex; flex-direction: column; height: 100vh; }

    /* Tabs */
    .tabs { display: flex; justify-content: space-between; align-items: center; padding: var(--space-3); background: var(--dark-surface-2); border-bottom: 1px solid var(--dark-border); position: sticky; top: 0; z-index: 10; }
    .tabs-left { display: flex; align-items: center; gap: var(--space-4); }
    .tab-buttons { display: flex; gap: 8px; }
    .tabs-right { display: flex; gap: var(--space-2); align-items: center; }
    
    /* Mobile Toolbar Styles */
    @media (max-width: 768px) {
      .tabs {
        padding: var(--space-2) var(--space-3);
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }
      
      .tabs-left {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
      }
      
      .app-title {
        font-size: 1.1rem;
        flex-shrink: 0;
      }
      
      .tab-buttons {
        display: flex;
        gap: 8px;
        flex-shrink: 0;
      }
      
      .tab {
        padding: 8px 16px;
        font-size: 0.875rem;
        white-space: nowrap;
      }
      
      .tabs-right {
        display: none;
      }
    }
     .app-title-link { 
       text-decoration: none; 
       display: inline-flex; 
       align-items: center;
       gap: 12px;
       transition: all var(--transition-coffee); 
       position: relative; 
       font-family: var(--font-mono-display);
     }
     .coffee-cup {
       width: 28px;
       height: 28px;
       position: relative;
       filter: drop-shadow(0 2px 8px rgba(255, 140, 66, 0.3));
       transition: all var(--transition-coffee);
     }
     .coffee-cup::before {
       content: '☕';
       font-size: 24px;
       position: absolute;
       top: 0;
       left: 0;
       background: var(--gradient-primary);
       -webkit-background-clip: text;
       -webkit-text-fill-color: transparent;
       background-clip: text;
       animation: coffee-steam 3s ease-in-out infinite;
     }
     .coffee-cup::after {
       content: '';
       position: absolute;
       top: -8px;
       left: 50%;
       transform: translateX(-50%);
       width: 2px;
       height: 12px;
       background: linear-gradient(to top, var(--coffee-steam), transparent);
       border-radius: 1px;
       animation: steam-rise 2s ease-out infinite;
       opacity: 0.7;
     }
     @keyframes coffee-steam {
       0%, 100% { transform: scale(1) rotate(0deg); }
       50% { transform: scale(1.1) rotate(5deg); }
     }
     @keyframes steam-rise {
       0% { opacity: 0; transform: translateX(-50%) translateY(0); }
       50% { opacity: 0.8; }
       100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
     }
     .app-title-link:hover .coffee-cup {
       transform: scale(1.1);
       filter: drop-shadow(0 4px 12px rgba(255, 140, 66, 0.5));
     }
     .app-title { 
       font-size: 1.25rem; 
       font-weight: 600; 
       background: var(--gradient-primary); 
       -webkit-background-clip: text; 
       -webkit-text-fill-color: transparent; 
       background-clip: text; 
       margin: 0; 
       transition: all var(--transition-coffee); 
       letter-spacing: -0.01em;
       text-shadow: 0 2px 4px rgba(255, 140, 66, 0.2);
       font-family: var(--font-mono-display);
     }
     .tab { 
       appearance: none; 
       border: 1px solid var(--dark-border); 
       background: var(--dark-surface-2); 
       color: var(--dark-text-secondary); 
       padding: 8px 14px; 
       border-radius: var(--radius-full); 
       cursor: pointer; 
       transition: all var(--transition-solar); 
       font-weight: 500; 
       position: relative; 
       overflow: hidden;
       letter-spacing: 0.01em;
     }
     .tab::before {
       content: '';
       position: absolute;
       top: 0;
       left: -100%;
       width: 100%;
       height: 100%;
       background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.1), transparent);
       transition: left 0.6s ease;
     }
     .tab:hover::before {
       left: 100%;
     }
     .tab:hover { 
       border-color: var(--accent-primary); 
       color: #fff; 
       box-shadow: var(--glow-primary); 
       transform: translateY(-1px);
     }
     .tab[aria-selected="true"] { 
       background: var(--gradient-primary); 
       color: #fff; 
       border-color: transparent; 
       box-shadow: var(--glow-primary); 
       transform: translateY(-1px); 
       font-weight: 600;
     }
     .tab[aria-selected="true"]::after { 
       content: ''; 
       position: absolute; 
       top: 0; 
       left: 0; 
       right: 0; 
       bottom: 0; 
       background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.15) 50%, transparent 70%); 
       animation: solar-flare 2s ease-in-out infinite; 
     }
     @keyframes solar-flare {
       0%, 100% { opacity: 0; }
       50% { opacity: 1; }
     }

    /* Panel */
    .panel { flex: 1; position: relative; }
    .frame { position: absolute; inset: 0; width: 100%; height: 100%; border: none; background: var(--dark-surface-1); }

    /* Basic a11y focus */
    .tab:focus { outline: 2px solid var(--accent-primary); outline-offset: 2px; }

     /* Pills */
     .pill { 
       display: inline-flex; 
       align-items: center; 
       gap: var(--space-2); 
       padding: var(--space-2) var(--space-3); 
       background: var(--dark-surface-2); 
       border: 1px solid var(--dark-border); 
       border-radius: var(--radius-full); 
       font-size: 0.75rem; 
       color: var(--dark-text-secondary); 
       transition: all var(--transition-solar); 
       position: relative; 
       overflow: hidden; 
       backdrop-filter: blur(4px);
     }
     .pill:hover { 
       background: var(--dark-surface-3); 
       border-color: var(--accent-primary); 
       transform: translateY(-1px); 
       box-shadow: var(--glow-primary); 
     }
     .pill:nth-child(2) { 
       background: var(--gradient-secondary); 
       color: var(--solar-black); 
       border-color: transparent; 
       font-weight: 600;
       text-shadow: 0 1px 2px rgba(0,0,0,0.1);
     }
    .pill-with-badge { position: relative; }
     .new-badge { 
       position: absolute; 
       top: -6px; 
       right: -8px; 
       background: var(--gradient-secondary); 
       color: var(--solar-black); 
       font-size: 0.6rem; 
       font-weight: 700; 
       padding: 2px 6px; 
       border-radius: 8px; 
       line-height: 1; 
       box-shadow: 0 2px 12px rgba(204, 255, 0, 0.6);
       animation: solar-pulse 1.5s ease-in-out infinite;
       text-shadow: 0 1px 1px rgba(0,0,0,0.2);
       border: 1px solid rgba(204, 255, 0, 0.3);
     }
     @keyframes solar-pulse {
       0%, 100% { transform: scale(1); box-shadow: 0 2px 12px rgba(204, 255, 0, 0.6); }
       50% { transform: scale(1.1); box-shadow: 0 4px 20px rgba(204, 255, 0, 0.8); }
     }
    @keyframes badge-pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    .status-indicator { width: 8px; height: 8px; border-radius: 50%; background: #10b981; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    /* Loader overlay - FIXED to prevent overlapping */
    .loader-overlay { 
      position:absolute; 
      inset:0; 
      display:none; 
      align-items:center; 
      justify-content:center; 
      background: var(--dark-bg); /* Solid background to prevent see-through */
      z-index: 1000; /* Ensure it's on top */
      opacity: 0;
      transition: opacity 200ms ease;
    }
    .loader-overlay.show { 
      display:flex; 
      opacity: 1;
    }
    .loader {
      display: grid; gap: 10px; width: min(600px, 80%);
    }
    .shimmer { position: relative; overflow: hidden; background: #1a1d23; border:1px solid var(--dark-border); border-radius: 10px; }
    .shimmer::before { content:""; position:absolute; inset:0; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent); transform: translateX(-100%); animation: shimmer 1.6s infinite; }
    @keyframes shimmer { 0% { transform: translateX(-100%);} 100% { transform: translateX(100%);} }
    .shimmer.small { height: 12px; }
    .shimmer.medium { height: 16px; }
    .shimmer.large { height: 42px; }
    .row-2 { height: 72px; }
    .rounded { border-radius: 9999px; }
    .pad { padding: 14px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="tabs">
       <div class="tabs-left">
         <a href="/" class="app-title-link" aria-label="Java Chat - Home">
           <div class="coffee-cup" aria-hidden="true"></div>
           <h1 class="app-title">Java Chat</h1>
         </a>
        <div class="tab-buttons" role="tablist" aria-label="Java Chat Sections">
          <button id="tab-chat" class="tab" role="tab" aria-selected="true" aria-controls="tabpanel" tabindex="0">Chat</button>
          <button id="tab-guided" class="tab" role="tab" aria-selected="false" aria-controls="tabpanel" tabindex="-1">Guided Learning</button>
        </div>
      </div>
      <div class="tabs-right">
        <span class="pill pill-with-badge">
          <span class="status-indicator"></span>
          JDK 25 Docs
          <span class="new-badge">New</span>
        </span>
        <span class="pill">AI-Powered Learning</span>
      </div>
    </div>

    <div id="tabpanel" class="panel" role="tabpanel" tabindex="0" aria-labelledby="tab-chat">
      <iframe id="contentFrame" class="frame" title="Content"></iframe>
      <div id="loader" class="loader-overlay" aria-hidden="true">
        <div class="loader" aria-label="Loading content">
          <div class="shimmer large pad"></div>
          <div class="shimmer medium rounded"></div>
          <div class="shimmer small rounded"></div>
          <div class="shimmer row-2 pad"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const frame = document.getElementById('contentFrame');
    const loader = document.getElementById('loader');
    const tabs = [
      { id: 'tab-chat', url: 'chat.html' },
      { id: 'tab-guided', url: 'guided.html' }
    ];

    let loaderTimeout = null;
    
    function setActiveTab(targetId) {
      tabs.forEach(({ id, url }) => {
        const el = document.getElementById(id);
        const isActive = id === targetId;
        el.setAttribute('aria-selected', String(isActive));
        el.tabIndex = isActive ? 0 : -1;
        if (isActive) {
          document.getElementById('tabpanel').setAttribute('aria-labelledby', id);
          
          // Only show loader after a small delay to prevent flash for fast loads
          if (loaderTimeout) clearTimeout(loaderTimeout);
          loaderTimeout = setTimeout(() => showLoader(true), 100);
          
          // Clear iframe first to prevent stale content flash
          frame.style.visibility = 'hidden';
          frame.src = url;
          
          // reflect in hash for deep-linking
          const hash = id === 'tab-guided' ? '#guided' : '#chat';
          if (location.hash !== hash) history.replaceState(null, '', hash);
        }
      });
    }

    // Click handlers
    tabs.forEach(({ id }) => {
      document.getElementById(id).addEventListener('click', () => setActiveTab(id));
    });

    // Keyboard navigation (Left/Right)
    document.querySelector('.tab-buttons').addEventListener('keydown', (e) => {
      const order = tabs.map(t => t.id);
      const activeIdx = order.findIndex(id => document.getElementById(id).getAttribute('aria-selected') === 'true');
      if (e.key === 'ArrowRight') {
        e.preventDefault();
        const next = order[(activeIdx + 1) % order.length];
        setActiveTab(next);
        document.getElementById(next).focus();
      } else if (e.key === 'ArrowLeft') {
        e.preventDefault();
        const prev = order[(activeIdx - 1 + order.length) % order.length];
        setActiveTab(prev);
        document.getElementById(prev).focus();
      }
    });

    // Hide loader when iframe finishes loading
    frame.addEventListener('load', () => {
      // Cancel pending loader if it hasn't shown yet
      if (loaderTimeout) {
        clearTimeout(loaderTimeout);
        loaderTimeout = null;
      }
      // Small delay to ensure content is painted
      setTimeout(() => {
        showLoader(false);
        frame.style.visibility = 'visible';
      }, 50);
    });

    // Immediately hide loader when inner page signals readiness
    window.addEventListener('message', (e) => {
      const data = e && e.data;
      if (!data || typeof data !== 'object') return;
      
      if (data.type === 'content-started' || data.type === 'content-ready' || data.type === 'dom-ready') {
        // Cancel pending loader
        if (loaderTimeout) {
          clearTimeout(loaderTimeout);
          loaderTimeout = null;
        }
        // Hide loader immediately
        showLoader(false);
        frame.style.visibility = 'visible';
      }
    });

    function showLoader(show) {
      const panel = document.getElementById('tabpanel');
      if (show) {
        loader.classList.add('show');
        panel.setAttribute('aria-busy', 'true');
      } else {
        loader.classList.remove('show');
        panel.setAttribute('aria-busy', 'false');
      }
    }

    // Initial tab selection from hash
    function initialTab() {
      const h = (location.hash || '').toLowerCase();
      if (h.includes('guided')) return 'tab-guided';
      return 'tab-chat';
    }

    // Initialize
    setActiveTab(initialTab());
  </script>
</body>
</html>
