<?xml version="1.0" encoding="UTF-8"?>
<FindBugsFilter>
    <!--
        Exclude WebMvcConfig from SpotBugs analysis due to bug in FindSecBugs
        CorsRegistryCORSDetector causing NPE on Spring CORS configuration.
        See: https://github.com/find-sec-bugs/find-sec-bugs/issues
    -->
    <Match>
        <Class name="com.williamcallahan.javachat.config.WebMvcConfig"/>
    </Match>

    <!--
        Error handlers must respond to any HTTP method that may trigger an error.
        CustomErrorController explicitly allows common methods to ensure consistent error rendering
        for browser requests and API clients; this is not an application endpoint intended for state changes.
    -->
    <Match>
        <Bug pattern="SPRING_CSRF_UNRESTRICTED_REQUEST_MAPPING"/>
        <Class name="com.williamcallahan.javachat.web.CustomErrorController"/>
        <Method name="handleError"/>
    </Match>

    <!--
        Spring-managed dependencies are intentionally shared; SpotBugs flags these as EI_EXPOSE_REP2,
        but these fields are not exposed via accessors and are required for DI.
    -->
    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
        <Class name="com.williamcallahan.javachat.service.DocsIngestionService"/>
    </Match>
    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
        <Class name="com.williamcallahan.javachat.service.EmbeddingCacheService"/>
    </Match>
    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
        <Class name="com.williamcallahan.javachat.service.MarkdownService"/>
    </Match>
    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
        <Class name="com.williamcallahan.javachat.service.MarkdownStreamProcessor"/>
    </Match>
    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
        <Class name="com.williamcallahan.javachat.service.RetrievalService"/>
    </Match>
    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
        <Class name="com.williamcallahan.javachat.web.ChatController"/>
    </Match>
    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
        <Class name="com.williamcallahan.javachat.web.GuidedLearningController"/>
    </Match>
    <Match>
        <Bug pattern="EI_EXPOSE_REP2"/>
        <Class name="com.williamcallahan.javachat.web.TooltipController"/>
    </Match>
</FindBugsFilter>
